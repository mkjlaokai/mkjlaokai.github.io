<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://smakerm.github.io</id>
    <title>Gridea</title>
    <updated>2021-09-08T09:50:33.496Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://smakerm.github.io"/>
    <link rel="self" href="https://smakerm.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°!!!</subtitle>
    <logo>https://smakerm.github.io/images/avatar.png</logo>
    <icon>https://smakerm.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[COLO]]></title>
        <id>https://smakerm.github.io/post/colo/</id>
        <link href="https://smakerm.github.io/post/colo/">
        </link>
        <updated>2021-08-12T02:51:05.000Z</updated>
        <content type="html"><![CDATA[<h1 id="1-coloåŸç†å›¾">1ã€COLOåŸç†å›¾</h1>
<h2 id="11-æ•´ä½“åŸç†">1.1 ã€æ•´ä½“åŸç†</h2>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/smakerm/cloud-images/raw/master/images/202108101646550.png" alt="COLOåŸç†å›¾" loading="lazy"></figure>
<pre><code>  Primary Node                                                            Secondary Node
+------------+  +-----------------------+       +------------------------+  +------------+
|            |  |       HeartBeat       +&lt;-----&gt;+       HeartBeat        |  |            |
| Primary VM |  +-----------+-----------+       +-----------+------------+  |Secondary VM|
|            |              |                               |               |            |
|            |  +-----------|-----------+       +-----------|------------+  |            |
|            |  |QEMU   +---v----+      |       |QEMU  +----v---+        |  |            |
|            |  |       |Failover|      |       |      |Failover|        |  |            |
|            |  |       +--------+      |       |      +--------+        |  |            |
|            |  |   +---------------+   |       |   +---------------+    |  |            |
|            |  |   | VM Checkpoint +--------------&gt;+ VM Checkpoint |    |  |            |
|            |  |   +---------------+   |       |   +---------------+    |  |            |
|Requests&lt;--------------------------\ /-----------------\ /---------------------&gt;Requests|
|            |  |                   ^ ^ |       |       | |              |  |            |
|Responses+---------------------\ /-|-|------------\ /-------------------------+Responses|
|            |  |               | | | | |       |  | |  | |              |  |            |
|            |  | +-----------+ | | | | |       |  | |  | | +----------+ |  |            |
|            |  | | COLO disk | | | | | |       |  | |  | | | COLO disk| |  |            |
|            |  | |   Manager +----------------------------&gt;| Manager  | |  |            |
|            |  | ++----------+ v v | | |       |  | v  v | +---------++ |  |            |
|            |  |  |+-----------+-+-+-++|       | ++-+--+-+---------+ |  |  |            |
|            |  |  ||   COLO Proxy     ||       | |   COLO Proxy    | |  |  |            |
|            |  |  || (compare packet  ||       | |(adjust sequence | |  |  |            |
|            |  |  ||and mirror packet)||       | |    and ACK)     | |  |  |            |
|            |  |  |+------------+---+-+|       | +-----------------+ |  |  |            |
+------------+  +-----------------------+       +------------------------+  +------------+
+------------+     |             |   |                                |     +------------+
| VM Monitor |     |             |   |                                |     | VM Monitor |
+------------+     |             |   |                                |     +------------+
+---------------------------------------+       +----------------------------------------+
|   Kernel         |             |   |  |       |   Kernel            |                  |
+---------------------------------------+       +----------------------------------------+
                   |             |   |                                |
    +--------------v+  +---------v---+--+       +------------------+ +v-------------+
    |   Storage     |  |External Network|       | External Network | |   Storage    |
    +---------------+  +----------------+       +------------------+ +--------------+
</code></pre>
<h2 id="12-ç½‘ç»œæµé‡åŸç†">1.2ã€ç½‘ç»œæµé‡åŸç†</h2>
<h3 id="121-åŸç†å›¾">1.2.1ã€åŸç†å›¾</h3>
<pre><code> Primary qemu                                                           Secondary qemu
+--------------------------------------------------------------+       +----------------------------------------------------------------+
| +----------------------------------------------------------+ |       |  +-----------------------------------------------------------+ |
| |                                                          | |       |  |                                                           | |
| |                        guest                             | |       |  |                        guest                              | |
| |                                                          | |       |  |                                                           | |
| +-------^--------------------------+-----------------------+ |       |  +---------------------+--------+----------------------------+ |
|         |                          |                         |       |                        ^        |                              |
|         |                          |                         |       |                        |        |                              |
|         |  +------------------------------------------------------+  |                        |        |                              |
|netfilter|  |                       |                         |    |  |   netfilter            |        |                              |
| +----------+ +----------------------------+                  |    |  |  +-----------------------------------------------------------+ |
| |       |  |                       |      |        out       |    |  |  |                     |        |  filter execute order      | |
| |       |  |          +-----------------------------+        |    |  |  |                     |        | +-------------------&gt;      | |
| |       |  |          |            |      |         |        |    |  |  |                     |        |   TCP                      | |
| | +-----+--+-+  +-----v----+ +-----v----+ |pri +----+----+sec|    |  |  | +------------+  +---+----+---v+rewriter++  +------------+ | |
| | |          |  |          | |          | |in  |         |in |    |  |  | |            |  |        |              |  |            | | |
| | |  filter  |  |  filter  | |  filter  +------&gt;  colo   &lt;------+ +--------&gt;  filter   +--&gt; adjust |   adjust     +--&gt;   filter   | | |
| | |  mirror  |  |redirector| |redirector| |    | compare |   |  |    |  | | redirector |  | ack    |   seq        |  | redirector | | |
| | |          |  |          | |          | |    |         |   |  |    |  | |            |  |        |              |  |            | | |
| | +----^-----+  +----+-----+ +----------+ |    +---------+   |  |    |  | +------------+  +--------+--------------+  +---+--------+ | |
| |      |   tx        |   rx           rx  |                  |  |    |  |            tx                        all       |  rx      | |
| |      |             |                    |                  |  |    |  +-----------------------------------------------------------+ |
| |      |             +--------------+     |                  |  |    |                                                   |            |
| |      |   filter execute order     |     |                  |  |    |                                                   |            |
| |      |  +----------------&gt;        |     |                  |  +--------------------------------------------------------+            |
| +-----------------------------------------+                  |       |                                                                |
|        |                            |                        |       |                                                                |
+--------------------------------------------------------------+       +----------------------------------------------------------------+
         |guest receive               | guest send
         |                            |
+--------+----------------------------v------------------------+
|                                                              |                          NOTE: filter direction is rx/tx/all
|                         tap                                  |                          rx:receive packets sent to the netdev
|                                                              |                          tx:receive packets sent by the netdev
+--------------------------------------------------------------+

</code></pre>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/smakerm/cloud-images/raw/master/images/202108101644054.png" alt="COLOåŸç†å›¾" loading="lazy"></figure>
<h2 id="13-è™šæ‹Ÿæœºå¯åŠ¨å‘½ä»¤">1.3ã€è™šæ‹Ÿæœºå¯åŠ¨å‘½ä»¤</h2>
<h3 id="131-ä¸»è™šæ‹Ÿæœº">1.3.1ã€ä¸»è™šæ‹Ÿæœº</h3>
<pre><code class="language-shell">/usr/bin/kvm -id 1000 -name s1-1 -qmp stdio -pidfile /var/run/qemu-server/1000.pid -smbios 'type=1,uuid=41a3e690-874a-444a-af73-061c04168425' -smp '1,sockets=1,cores=1,maxcpus=1' -nodefaults -boot 'menu=on,strict=on,reboot-timeout=1000,splash=/usr/share/qemu-server/bootsplash.jpg' -vnc unix:/var/run/qemu-server/1000.vnc,password -cpu kvm64,+lahf_lm,+sep,+kvm_pv_unhalt,+kvm_pv_eoi,+kvmclock,enforce -m 512 \
-chardev 'socket,id=mirror0,host=0.0.0.0,port=9000,server,nowait' \
-chardev 'socket,id=compare1,host=0.0.0.0,port=9001,server,wait' \
-chardev 'socket,id=compare0,host=127.0.0.1,port=9002,server,nowait' \
-chardev 'socket,id=compare0-0,host=127.0.0.1,port=9002' \
-chardev 'socket,id=compare_out,host=127.0.0.1,port=9003,server,nowait' \
-chardev 'socket,id=compare_out0,host=127.0.0.1,port=9003' \
-object 'filter-mirror,id=m0,netdev=net0,queue=tx,outdev=mirror0' \
-object 'filter-redirector,netdev=net0,id=redire0,queue=rx,indev=compare_out' \
-object 'filter-redirector,netdev=net0,id=redire1,queue=rx,outdev=compare0' \
-object 'iothread,id=iothread1' \
-object 'colo-compare,id=comp0,primary_in=compare0-0,secondary_in=compare1,outdev=compare_out0,iothread=iothread1' \
-S -device 'pci-bridge,id=pci.2,chassis_nr=2,bus=pci.0,addr=0x1f' -device 'pci-bridge,id=pci.1,chassis_nr=1,bus=pci.0,addr=0x1e' -device 'piix3-usb-uhci,id=uhci,bus=pci.0,addr=0x1.0x2' -device 'usb-tablet,id=tablet,bus=uhci.0,port=1' -device 'VGA,id=vga,vgamem_mb=16,bus=pci.0,addr=0x2' -chardev 'socket,path=/var/run/qemu-server/1000.qga,server,nowait,id=qga0' -device 'virtio-serial,id=qga0,bus=pci.0,addr=0x8' -device 'virtserialport,chardev=qga0,name=org.qemu.guest_agent.0' -device 'virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x3' -iscsi 'initiator-name=iqn.1993-08.org.debian:01:d5f26f3c2116' -drive 'if=none,id=drive-ide2,media=cdrom,aio=threads' -device 'ide-cd,bus=ide.1,unit=0,drive=drive-ide2,id=ide2,bootindex=200' -device 'virtio-scsi-pci,id=scsihw0,bus=pci.0,addr=0x5' \
-drive 'children.0.file.filename=/dev/vcl/vm-1000-disk-0,if=none,id=drive-scsi0,children.0.driver=raw,driver=quorum,read-pattern=fifo,vote-threshold=1,cache=none,aio=native,detect-zeroes=on' \
-device 'scsi-hd,bus=scsihw0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0,id=scsi0,bootindex=100' \
-netdev 'type=tap,id=net0,ifname=tap1000i0,script=/var/lib/qemu-server/pve-bridge,downscript=/var/lib/qemu-server/pve-bridgedown' -device 'virtio-net-pci,mac=B2:32:7F:5E:46:96,netdev=net0,bus=pci.0,addr=0x12,id=net0,bootindex=300' -machine 'type=pc' -uuid 3ff7587a-c7e1-4232-9184-ff0b6be230e5
</code></pre>
<h3 id="132-è¾…è™šæ‹Ÿæœº">1.3.2ã€è¾…è™šæ‹Ÿæœº</h3>
<pre><code class="language-shell">/usr/bin/kvm -id 100 -name s1 -qmp stdio -pidfile /var/run/qemu-server/100.pid -smbios 'type=1,uuid=429bec25-2a72-4a8f-b521-889e6ac3f2fa' -smp '1,sockets=1,cores=1,maxcpus=1' -nodefaults -boot 'menu=on,strict=on,reboot-timeout=1000,splash=/usr/share/qemu-server/bootsplash.jpg' -vnc unix:/var/run/qemu-server/100.vnc,password -cpu kvm64,+lahf_lm,+sep,+kvm_pv_unhalt,+kvm_pv_eoi,+kvmclock,enforce -m 512 \
-chardev 'socket,id=red0,host=172.16.18.111,port=9000,reconnect=1' \
-chardev 'socket,id=red1,host=172.16.18.111,port=9001,reconnect=1' \
-object 'filter-redirector,id=f1,netdev=net0,queue=tx,indev=red0' \
-object 'filter-redirector,id=f2,netdev=net0,queue=rx,outdev=red1' \
-object 'filter-rewriter,id=rew0,netdev=net0,queue=all' \
-incoming tcp:0:9000 \
-device 'pci-bridge,id=pci.2,chassis_nr=2,bus=pci.0,addr=0x1f' -device 'pci-bridge,id=pci.1,chassis_nr=1,bus=pci.0,addr=0x1e' -device 'piix3-usb-uhci,id=uhci,bus=pci.0,addr=0x1.0x2' -device 'usb-tablet,id=tablet,bus=uhci.0,port=1' -device 'VGA,id=vga,vgamem_mb=16,bus=pci.0,addr=0x2' -chardev 'socket,path=/var/run/qemu-server/100.qga,server,nowait,id=qga0' -device 'virtio-serial,id=qga0,bus=pci.0,addr=0x8' -device 'virtserialport,chardev=qga0,name=org.qemu.guest_agent.0' -device 'virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x3' -iscsi 'initiator-name=iqn.1993-08.org.debian:01:4d39289a37c' -drive 'if=none,id=drive-ide2,media=cdrom,aio=threads' -device 'ide-cd,bus=ide.1,unit=0,drive=drive-ide2,id=ide2,bootindex=200' -device 'virtio-scsi-pci,id=scsihw0,bus=pci.0,addr=0x5' \
-drive 'file.filename=/dev/vcl/vm-100-disk-0,if=none,id=parent0,driver=raw' \
-drive 'if=none,id=childs0,driver=replication,mode=secondary,file.driver=qcow2,top-id=drive-scsi0,file.file.filename=/var/lib/vz/images/100/active0.qcow2,file.backing.driver=qcow2,file.backing.file.filename=/var/lib/vz/images/100/hidden0.qcow2,file.backing.backing=parent0' \
-drive 'if=none,id=drive-scsi0,driver=quorum,read-pattern=fifo,vote-threshold=1,children.0=childs0' \
-device 'scsi-hd,bus=scsihw0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0,id=scsi0' \
-netdev 'type=tap,id=net0,ifname=tap100i0,script=/var/lib/qemu-server/pve-bridge,downscript=/var/lib/qemu-server/pve-bridgedown' -device 'virtio-net-pci,mac=1A:34:75:DD:50:F9,netdev=net0,bus=pci.0,addr=0x12,id=net0,bootindex=300' -machine 'type=pc' -uuid 1af12e44-600f-4768-a17d-bffc157fab36
</code></pre>
<h2 id="14-coloè™šæ‹Ÿæœºå¯åŠ¨æµç¨‹">1.4ã€COLOè™šæ‹Ÿæœºå¯åŠ¨æµç¨‹</h2>
<h3 id="141-coloè™šæ‹Ÿæœºå¯åŠ¨">1.4.1ã€COLOè™šæ‹Ÿæœºå¯åŠ¨</h3>
<pre><code class="language-mermaid">%% æ—¶åºå›¾ä¾‹å­,-&gt; ç›´çº¿ï¼Œ--&gt;è™šçº¿ï¼Œ-&gt;&gt;å®çº¿ç®­å¤´
  sequenceDiagram
    participant PVM
    participant SVM
    PVM --&gt; PVM: å¼€å¯PVM
    SVM --&gt; SVM: å¼€å¯SVM
    SVM -&gt;&gt; PVM: SVM å¼€å¯NBDæœåŠ¡
    PVM -&gt;&gt; SVM: PVMå¼€å¯COLOè¿ç§»
    note over PVM,SVM: æ­£å¸¸è¿è¡Œ
</code></pre>
<h3 id="142-è¾…è™šæ‹Ÿæœºæ•…éšœæ¢å¤">1.4.2ã€è¾…è™šæ‹Ÿæœºæ•…éšœæ¢å¤</h3>
<pre><code class="language-mermaid">%% æ—¶åºå›¾ä¾‹å­,-&gt; ç›´çº¿ï¼Œ--&gt;è™šçº¿ï¼Œ-&gt;&gt;å®çº¿ç®­å¤´
  sequenceDiagram
    participant PVM
    participant SVM
    note over PVM,SVM: æ¨¡æ‹ŸSVMæ•…éšœ
    PVM --&gt; PVM: ç§»é™¤object,æ‰‹åŠ¨åœæ­¢COLOæœåŠ¡
    PVM --&gt; SVM: PVMæ­£å¸¸è¿è¡Œ
    SVM --&gt; SVM: å†æ¬¡å¯åŠ¨SVM
    loop åŒæ­¥ç£ç›˜
    	PVM --&gt; PVM: åŒæ­¥ç£ç›˜
    end
    PVM --&gt; PVM: æ·»åŠ object
    PVM -&gt;&gt; SVM: PVMå¼€å¯COLOè¿ç§»

</code></pre>
<h3 id="143-ä¸»è™šæ‹Ÿæœºæ•…éšœæ¢å¤">1.4.3ã€ ä¸»è™šæ‹Ÿæœºæ•…éšœæ¢å¤</h3>
<pre><code class="language-mermaid">%% æ—¶åºå›¾ä¾‹å­,-&gt; ç›´çº¿ï¼Œ--&gt;è™šçº¿ï¼Œ-&gt;&gt;å®çº¿ç®­å¤´
  sequenceDiagram
    participant PVM
    participant SVM
    note over PVM,SVM: æ­£å¸¸è¿è¡Œ
    note over PVM,SVM: æ¨¡æ‹ŸPVMæ•…éšœ
    SVM --&gt; SVM: åˆ é™¤ç½‘å¡é‡å®šå‘çš„è®¾å¤‡,åœæ­¢COLOæœåŠ¡
    SVM --&gt; SVM: å‡†å¤‡ä½œä¸ºä¸»è™šæ‹Ÿæœºéœ€è¦çš„èµ„æº
    SVM --&gt; SVM: SVMæ­£å¸¸è¿è¡Œ
    PVM --&gt; PVM: ä»¥SVMèº«ä»½å¯åŠ¨PVM
    loop åŒæ­¥ç£ç›˜
    	SVM --&gt; SVM: åŒæ­¥ç£ç›˜
    end
    SVM --&gt; SVM: æ·»åŠ object
    SVM -&gt;&gt; PVM: SVMå¼€å¯COLOè¿ç§»
    note over PVM,SVM: æ­£å¸¸è¿è¡Œï¼Œèº«ä»½è½¬åŒ–
    note over PVM,PVM: SVM
    note over SVM,SVM: PVM
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://smakerm.github.io/post/hello-gridea/</id>
        <link href="https://smakerm.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>